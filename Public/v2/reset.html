<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>重置用户信息</title>
<link href="css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="css/index.css">
<style type="text/css">
.reset-title{
	text-align: center;
	padding: 50px 0 30px;
	font-size: 24px;
}
.default-form-submit{
	margin-bottom: 10px;
}
</style>
</head>
<body>
	<div class="wrap">
		<div class="content">
			
			<div class="register-box">
				<div class="register-form">
					<h3 class="reset-title">系统更新，请重置您的用户信息!</h3>
					<div id="register-phone-form" class="register-list active">		
						<div class="register-item">
							<h5 class="form-label">请选择验证方式</h5>
							<div class="select-100" id="validate">
								<select id="validate-select" class="form-input vhide select3" name="pay">
									<option value="0">请选择</option>
									<option value="email">邮箱验证</option>
									<option value="phone">短信验证</option>
								</select>
							</div>
						</div>	
						<div class="register-item register-code">
							<label>验证码</label>
							<p><input name="name[]" type="text" id="verify" placeholder="输入验证码"><img id="verify_up" src="http://bjsphp.com/Verify/code.html" title="换一张" onclick="this.src=this.src+'?t='+Math.random()" width="100" height="34">
							</p>
						</div>
						<div class="register-item">
							<h5 class="form-label">获取验证码</h5>
							<div class="input-group input-group-r">
								<input class="form-control form-input" id="moble_verify"  type="text" name="code" placeholder="请输入验证码"><a class="input-group-addon tc" id="reg_moble_new" onclick="moble_findpwd('sms')" href="javascript:;">获取</a>
							</div>
						</div>				
						<!-- <div class="register-item">
							<label>原密码</label>
							<input type="password" name="name" placeholder="输入原密码" />
						</div> -->
						<div class="register-item">
							<label>新密码</label>
							<input type="password" name="name" placeholder="输入新密码" id="newpassword" />
						</div>
						<div class="register-item">
							<label>确认新密码</label>
							<input type="password" name="name" placeholder="确认新密码" id="repassword" />
						</div>
						<!-- <div class="register-item">
							<label>原交易密码</label>
							<input type="password" name="name" placeholder="输入原交易密码" />
						</div> -->
						<div class="register-item">
							<label>新交易密码</label>
							<input type="password" name="name" placeholder="输入新交易密码" id="newpaypassword" />
						</div>
						<div class="register-item">
							<label>确认新交易密码</label>
							<input type="password" name="name" placeholder="确认新交易密码" id="repaypassword" />
						</div>							
						<div class="register-item tc login-form-item clearfix">
							<p><a class="default-form-submit" href="javascript:password_up()">重置</a></p>
							<p class="picon-warning tl">提示： 必须重置用户信息才能进行交易！</p>
						</div>
					</div>
					
				</div>
			</div>
		</div>
	</div>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.cookies.2.2.0.js"></script>
<script type="text/javascript" src="layer/layer.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script src="js/select2.min.js"></script>
<script type="text/javascript" src="js/md5.js"></script>
<script type="text/javascript">
	var home = new bjsIndex();
	$('.select3').select2({
	        minimumResultsForSearch: -1,
	        dropdownAutoWidth: true
	    });
	//submit 事件
	$('.register-form').on('keyup','input',function(e){
		if(e.keyCode == 13){
			$('.login-form-submit').click();
		}
	});

    function moble_findpwd(type) {
        if($('#reg_moble_new').html() != '获取'){
            return;
        }
		var verify = $("#verify").val();		
		var moble  = $('#validate-select').val();
		var mobles = $('#mobles').val();
		if (moble == 0) {
			layer.tips("请选择验证方式", '#validate', {tips: 2});
			return false;
		}
		if (verify == "" || verify == null) {
			layer.tips("请输入图形验证码", '#verify', {tips: 2});
			return false;
		}
		$.post("/verify/moble_findpwd.html", {
			moble: moble,
			mobles: mobles,
			type: type,
			verify: verify,
			token: ""
		}, function (data) {
			if (data.status == 1) {
				layer.msg(data.info, {icon: 1});
				$("#moble_verify").focus();
				$('#validate-select').attr("disabled", "disabled");
				$('#mobles').attr("disabled", "disabled");
				var obj      = $('#reg_moble_new');
				var wait     = 30;
				var interval = setInterval(function () {
					obj.html("" + wait + "秒");
					wait--;
					if (wait < 0) {
						clearInterval(interval);
						$(".reloadverify").click();
						$("#verify").val('');
						obj.html('获取');
					}
					;
				}, 1000);
			} else {
				$(".reloadverify").click();
				layer.msg(data.info, {icon: 2,time:2000},function(){
                    if (data.url) {
                        window.location = data.url;
                    }
				});
			}
		}, "json");
	}
	function password_up() {
		var verify = $("#verify").val();		
		var moble  = $('#validate-select').val();
		var mobles = $('#mobles').val();
		var moble_verify = $("#moble_verify").val();
		if (moble == 0) {
			layer.tips("请选择验证方式", '#validate', {tips: 2});
			return false;
		}
		if (moble_verify == "" || moble_verify == null) {
			layer.tips("请输入验证码", '#moble_verify', {tips: 2});
			return false;
		}

		var newpassword = $('#newpassword').val();
		var repassword  = $('#repassword').val();
		var newpaypassword = $('#newpaypassword').val();
		var repaypassword  = $('#repaypassword').val();

		//确认密码
		if (newpassword == '' || newpassword == null) {
			layer.tips("请输入新登录密码", '#newpassword', {tips: 2});
			return false;
		}
		if (repassword != newpassword) {
			layer.tips("确认密码错误", '#repassword', {tips: 2});
			return false;
		}

		//确认交易密码
		if (newpaypassword == '' || newpaypassword == null) {
			layer.tips("请输入新交易密码", '#newpaypassword', {tips: 2});
			return false;
		}
		if (repaypassword != newpaypassword) {
			layer.tips("确认交易密码错误", '#repaypassword', {tips: 2});
			return false;
		}
        layer.load();
		$.post("/user/uppassword_qq3479015851.html", {
			moble: moble,
			mobles: mobles,
			verify: verify,
			moble_verify: moble_verify,
			newpassword: hex_md5(newpassword),
			repassword: hex_md5(repassword),
			newpaypassword: hex_md5(newpaypassword),
			repaypassword: hex_md5(repaypassword)
		}, function (data) {
			if (data.status == 1) {
				layer.msg(data.info, {icon: 1,time:2000},function () {
                    if (data.url) {
                        window.location = data.url;
                    } else {
                        window.location.reload();
                    }
                });
			} else {
				layer.msg(data.info, {icon: 2,time:2000},function () {
                    if (data.url) {
                        window.location = data.url;
                    }
                });
			}
            layer.closeAll('loading');
		}, 'json');
	}
</script>
</body>
</html>
