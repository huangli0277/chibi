<include file="Public:header" xmlns="http://www.w3.org/1999/html"/>
<div class="content">
    <link rel="stylesheet" href="__PUBLIC__/v2/js/intl-tel-input/css/intlTelInput.css">
	<div class="slide-unit register-logo">
		{$Think.Lang.V_LOGIN_REGISTER_1}
	</div>
	<div class="register-box">
		<div class="register-head">
			<a href="#" id="register-phone" class="active">{$Think.Lang.V_LOGIN_REGISTER_2}</a>
			<a href="#" id="register-email">{$Think.Lang.V_LOGIN_REGISTER_3}</a>
		</div>
		<div class="register-form">
			<div id="register-phone-form" class="register-list active">
				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_4}</label>
					<div class="clearfix">
                        <input type="tel" class="intlTelInput-tel" id="moble" placeholder="{$Think.Lang.V_LOGIN_REGISTER_5}" onblur="check_moble()">
					</div>
				</div>

				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_6}</label>
					<div class="clearfix">
						<div class="register-phone-select">
							<img id="verify_up" src="{:U('Verify/code')}" title="{$Think.Lang.V_LOGIN_REGISTER_7}" onclick="this.src=this.src+'?t='+Math.random()" width="100" height="34"/>
						</div>
						<div class="clearfix register-phone-input">
							<div class="register-code-input">
								<input type="text" id="verify" name="phone" placeholder="{$Think.Lang.V_LOGIN_REGISTER_8}" />
							</div>
							<div class="register-code-btn">
								<a class="register-phone-code-btn" href="javascript:;" id="moble_reg_send" onclick="moble_reg('sms')">{$Think.Lang.V_LOGIN_REGISTER_9}</a>
							</div>
						</div>
					</div>
				</div>

				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_10}</label>
					<input id="moble_verify" type="text" name="name" placeholder="{$Think.Lang.V_LOGIN_REGISTER_11}" />
				</div>
				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_12}</label>
					<input type="password" id="password" name="name" placeholder="{$Think.Lang.V_LOGIN_REGISTER_13}" />
				</div>
				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_14}</label>
					<input type="password" id="passwordConfirm" name="name" placeholder="{$Think.Lang.V_LOGIN_REGISTER_15}" />
				</div>
				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_16}</label>
					<input id="invit" type="text" value="{$invitCode}" name="name" placeholder="{$Think.Lang.V_LOGIN_REGISTER_17}"/>
				</div>
				<div class="register-item tc register-agreement">
					<!--<span  id="regweb">我已阅读并同意《<a href="javascript:;" onclick="regWeb();">用户协议</a>》</span>-->
					<label><input type="checkbox" name="name" class="hide" id="regweb"><span id="regweb-tip">{$Think.Lang.V_LOGIN_REGISTER_18}</span></label>《<a href="javascript:;" onclick="regWeb();">{$Think.Lang.V_LOGIN_REGISTER_19}</a>》
				</div>
				<div class="register-item tc">
					<a class="register-form-submit disabled-submit-btn" onclick="reg_up();" href="#">{$Think.Lang.V_LOGIN_REGISTER_20}</a>
				</div>
			</div>
			<div id="register-email-form" class="register-list">
				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_21}</label>
					<input type="text" id="email" name="email" placeholder="{$Think.Lang.V_LOGIN_REGISTER_22}" onblur="check_email()"/>
					<span id="reg_mail" class="" style="position: absolute; left: 190px;top: 2px;"></span>
				</div>
				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_6}</label>
					<div class="clearfix">
						<div class="register-phone-select">
							<img id="verifyUpEmail" src="{:U('Verify/code')}" title="{$Think.Lang.V_LOGIN_REGISTER_7}" onclick="this.src=this.src+'?t='+Math.random()" width="100" height="34"/>
						</div>
						<div class="clearfix register-phone-input">
							<div class="register-code-input">
								<input type="text" id="verifyEmail" name="phone" placeholder="{$Think.Lang.V_LOGIN_REGISTER_8}" />
							</div>
							<div class="register-code-btn">
								<a class="register-phone-code-btn" href="javascript:;" id="email_reg_send" onclick="email_reg_code('mail')">{$Think.Lang.V_LOGIN_REGISTER_9}</a>
							</div>
						</div>
					</div>
				</div>
				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_23}</label>
					<input id="email_verify" type="text" name="name" placeholder="{$Think.Lang.V_LOGIN_REGISTER_11}" />
				</div>
				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_12}</label>
					<input type="password" id="passwordEmail" name="name" placeholder="{$Think.Lang.V_LOGIN_REGISTER_13}" />
				</div>
				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_14}</label>
					<input type="password" id="passwordConfirmEmail" name="name" placeholder="{$Think.Lang.V_LOGIN_REGISTER_15}" />
				</div>
				<div class="register-item">
					<label>{$Think.Lang.V_LOGIN_REGISTER_16}</label>
					<input type="text" id="invitEmail" value="{$invitCode}" name="name" placeholder="{$Think.Lang.V_LOGIN_REGISTER_17}"/>
				</div>
				<div class="register-item tc register-agreement">
					<label><input type="checkbox" name="name" class="hide" id="regEmail"><span id="regEmail-tip">{$Think.Lang.V_LOGIN_REGISTER_18}</span></label>《<a href="javascript:;" onclick="regWeb();">{$Think.Lang.V_LOGIN_REGISTER_19}</a>》
				</div>
				<div class="register-item tc">
					<a class="register-form-submit disabled-submit-btn" onclick="email_reg_up();" href="#">{$Think.Lang.V_LOGIN_REGISTER_20}</a>
				</div>
			</div>
			<div class="register-form-info tc">{$Think.Lang.V_LOGIN_REGISTER_24}</div>
		</div>
	</div>
</div>
<script type="text/javascript" src="__PUBLIC__/m/js/md5.js"></script>
<script type="text/javascript" src="__PUBLIC__/v2/js/intl-tel-input/js/intlTelInput.js"></script>
<script type="text/javascript">
    //初始化国际号码选择
    $("#moble").intlTelInput({
        initialCountry: 'cn',
        separateDialCode: true,
        utilsScript: "__PUBLIC__/v2/js/intl-tel-input/js/utils.js"
    });
    $(document).on('click','.selected-flag',function(){
        $('.country-list').width($('.intlTelInput-tel').outerWidth()-2);
        $('.country-list .country-name').each(function(){
            if(!$(this).attr('title')){
                $(this).attr('title',$(this).text());
            }
        });
    });
    $(window).on('resize',function(){
        $('.country-list').width($('.intlTelInput-tel').outerWidth()-2);
    });
  
</script>
<script>
	$(function () {
		var register = new bjsIndex();
		register.initRegister();
    });
    $("#registerBtn").addClass("active");

    function regWeb() {
        layer.open({
            type: 2,
            skin: 'layui-layer-rim', // 边框
            area: ['800px', '600px'], // 宽高
            title: lange.LOGIN_REGISTER_1, // 标题
            content: "{:U('Login/webreg')}"
        });
    }

    function check_moble() {
        var moble  = '00'+$('.selected-dial-code').text().replace('\+','')+$('#moble').val();
        var mobles = '';
        if ($('#moble').val() == "" || $('#moble').val() == null) {
            layer.tips(lange.LOGIN_FINDPAYPWD_1, '#moble', {tips: 2});
            return false;
        }
        moble = moble.replace(/\s/,'');
        $.post("/login/check_moble.html", {
            moble: moble,
            mobles: mobles,
            token: ""
        }, function (data) {
            if (data.status == 1) {
                $("#verify").focus();
            } else {
                layer.tips(data.info, '#moble', {tips: 2});
                return false;
            }
        }, 'json');
    }
    function verify_ups() {
        $('#verify_up').attr('src', "/ajax/verify.html?t=" + Math.random());
    }
    function new_send() {
        $("#step1").show();
        $("#step2").show();
        $("#verify").focus();
    }
    function new_sends() {
        var moble  = '00'+$('.selected-dial-code').text().replace('\+','')+$('#moble').val();
        var mobles = '';
        if ($('#moble').val() == "" || $('#moble').val() == null) {
            layer.tips(lange.LOGIN_FINDPAYPWD_1, '#moble', {tips: 2});
            return false;
        }
        moble = moble.replace(/\s/,'');
        $.post("/login/check_moble.html", {
            moble: moble,
            mobles: mobles,
            token: ""
        }, function (data) {
            if (data.status == 1) {
                $("#verify").focus();
            } else {
                layer.tips(data.info, '#moble', {tips: 2});
                return false;
            }
        }, 'json');
    }
    function moble_reg(type) {
        if($('#moble_reg_send').html() != lange.LOGIN_FINDPWD_6){
            return;
        }
        var moble  = '00'+$('.selected-dial-code').text().replace('\+','')+$('#moble').val();
        var mobles = $("#mobles").val();
        var verify = $("#verify").val();
        if ($('#moble').val() == "" || $('#moble').val() == null) {
            layer.tips(lange.LOGIN_FINDPAYPWD_1, '#moble', {tips: 2});
            return false;
        }
        if (verify == "" || verify == null) {
            layer.tips(lange.FINDPWD_FINDPWD_2, '#verify', {tips: 2});
            return false;
        }
        moble = moble.replace(/\s/,'');
        $.post("/login/real.html", {
            moble: moble,
            mobles: mobles,
            type: type,
            verify: verify,
            token: ""
        }, function (data) {
            if (data.status == 1) {
                layer.msg(data.info, {icon: 1});

                $("#moble_verify").focus();
                $('#moble').attr("disabled", "disabled");
                $('#mobles').attr("disabled", "disabled");
                var obj      = $('#moble_reg_send');
                var wait     = 60;
                var interval = setInterval(function () {
                    obj.html(wait + lange.FINANCE_OUT_SENDSMS2);
                    wait--;
                    if (wait < 0) {
                        clearInterval(interval);
                        obj.html(lange.LOGIN_FINDPWD_2);
                    }
                    ;
                }, 1000);
            } else {
                layer.msg(data.info, {icon: 2,time:2000},function(){
                    if (data.url) {
                        window.location = data.url;
                    }
				});
            }
        }, "json");
    }

    function check_email(){
        var email  = $('#email').val();
        if (email == "" || email == null) {
            layer.tips(lange.LOGIN_FINDPWD_12, '#email', {tips: 2});
            return false;
        }
        $.post("/login/check_mail.html", {
            email: email,
            token: ""
        }, function (data) {
            if (data.status == 1) {
                $("#verifyEmail").focus();
            } else {
                layer.tips(data.info, '#email', {tips: 2});
                return false;
            }
        }, 'json');
	}

    function email_reg_code(type){
        if($('#email_reg_send').html() != lange.LOGIN_FINDPWD_2){
            return;
        }
        var email  = $("#email").val();
        var verifyEmail = $("#verifyEmail").val();
        if (email == "" || email == null) {
            layer.tips(lange.LOGIN_FINDPWD_12, '#email', {tips: 2});
            return false;
        }
        if (verifyEmail == "" || verifyEmail == null) {
            layer.tips(lange.FINDPWD_FINDPWD_2, '#verifyEmail', {tips: 2});
            return false;
        }
        $.post("/login/real_mail.html", {
            email: email,
            type: type,
            verifyEmail: verifyEmail,
            token: ""
        }, function (data) {
            if (data.status == 1) {
                layer.msg(data.info, {icon: 1});
                $("#verifyEmail").focus();
                $('#email').attr("disabled", "disabled");
                var obj      = $('#email_reg_send');
                var wait     = 60;
                var interval = setInterval(function () {
                    obj.html(wait + lange.FINANCE_OUT_SENDSMS2);
                    wait--;
                    if (wait < 0) {
                        clearInterval(interval);
                        obj.html(lange.LOGIN_FINDPWD_2);
                    }
                    ;
                }, 1000);
            } else {
                layer.msg(data.info, {icon: 2,time:2000},function(){
                    if (data.url) {
                        window.location = data.url;
                    }
				});
            }
        }, "json");
	}
    function reg_up() {
        var moble        = '00'+$('.selected-dial-code').text().replace('\+','')+$('#moble').val();
        var mobles       = $("#mobles").val();
        var moble_verify = $("#moble_verify").val();
        var password     = $("#password").val();
        var passwordConf = $("#passwordConfirm").val();
        var invit        = $("#invit").val();

        if ($('#moble').val() == "" || $('#moble').val() == null) {
            layer.tips(lange.LOGIN_FINDPAYPWD_1, '#moble', {tips: 2});
            return false;
        }
        if (moble_verify == "" || moble_verify == null) {
            layer.tips(lange.FINDPWD_FINDPWD_6, '#moble_verify', {tips: 2});
            return false;
        }
        if (password == "" || password == null) {
            layer.tips(lange.LOGIN_REGISTER_5, '#password', {tips: 2});
            return false;
        }
        if(passwordConf != password){
            layer.tips(lange.LOGIN_REGISTER_6, '#password', {tips: 2});
            $("#password").val('');
            $("#passwordConfirm").val('');
            return false;
		}
        if (!$("#regweb").is(':checked')) {
            layer.tips(lange.LOGIN_REGISTER_7, '#regweb-tip', {tips: 3});
            return false;
        }


        moble = moble.replace(/\s/,'');

        $.post("/login/upregister/", {
            username:moble,
            moble: moble,
            mobles: mobles,
            moble_verify: moble_verify,
            password: hex_md5(password),
            repassword: hex_md5(passwordConf),
            invit: invit,
            token: ""
        }, function (data) {
            if (data.status==1) {
                $.cookies.set('move_moble', moble);
                $.cookies.set('move_mobles', mobles);
                layer.msg(data.info, {icon: 1,time:2000},function(){
                    window.location = '/Login/paypassword';
				});
            } else {
                layer.msg(data.info, {icon: 2,time:2000},function(){
                    if (data.url) {
                        window.location = data.url;
                    }
				});
            }
        }, "json");
    }

    function email_reg_up(){
        var email        = $("#email").val();
        var email_verify = $("#email_verify").val();
        var password     = $("#passwordEmail").val();
        var passwordConf = $("#passwordConfirmEmail").val();
        var invit        = $("#invitEmail").val();

        if (email == "" || email == null) {
            layer.tips(lange.LOGIN_FINDPWD_12, '#email', {tips: 2});
            return false;
        }

        if (email_verify == "" || email_verify == null) {
            layer.tips(lange.LOGIN_REGISTER_8, '#email_verify', {tips: 2});
            return false;
        }
        if (password == "" || password == null) {
            layer.tips(lange.LOGIN_REGISTER_5, '#passwordEmail', {tips: 2});
            return false;
        }
        if(passwordConf != password){
            layer.tips(lange.LOGIN_REGISTER_6, '#passwordEmail', {tips: 2});
            $("#passwordEmail").val('');
            $("#passwordConfirmEmail").val('');
            return false;
        }
        if (!$("#regEmail").is(':checked')) {
            layer.tips(lange.LOGIN_REGISTER_7, '#regEmail-tip', {tips: 3});
            return false;
        }

        $.post("/login/upregisterEmail/", {
            email: email,
            emailVerify: email_verify,
            password: hex_md5(password),
            invit: invit,
            token: ""
        }, function (data) {
            if (data.status==1) {
                $.cookies.set('move_moble', email);
                layer.msg(data.info, {icon: 1,time:2000},function(){
                    window.location = '/Login/paypassword';
				});
            } else {
                layer.msg(data.info, {icon: 2,time:2000},function(){
                    if (data.url) {
                        window.location = data.url;
                    }
				});
            }
        }, "json");
	}
</script>

<include file="Public:footer" />
