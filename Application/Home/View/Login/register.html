<include file="Public:header" xmlns="http://www.w3.org/1999/html"/>
<div class="content">
	<div class="slide-unit register-logo">
		<img src="__PUBLIC__/v2/images/register-1.jpg">
	</div>
	<div class="register-box">
		<div class="register-head">
			<a href="#" id="register-phone" class="active">手机注册</a>
			<a href="#" id="register-email">邮箱注册</a>
		</div>
		<div class="register-form">
			<div id="register-phone-form" class="register-list active">
				<div class="register-item">
					<label>手机号码</label>
					<div class="clearfix">
						<div class="register-phone-select">
							<select class="select2 vhide">
								<option value="0" data-foo="bar1">+86</option>
							</select>
						</div>
						<div class="register-phone-input">
							<input type="text" id="mobles" style="display: none;">
							<input type="text" id="moble" placeholder="请输入手机号码" onblur="check_moble()" />
						</div>
					</div>
				</div>

				<div class="register-item">
					<label>获取验证码</label>
					<div class="clearfix">
						<div class="register-phone-select">
							<img id="verify_up" src="{:U('Verify/code')}" title="换一张" onclick="this.src=this.src+'?t='+Math.random()" width="100" height="34"/>
						</div>
						<div class="clearfix register-phone-input">
							<div class="register-code-input">
								<input type="text" id="verify" name="phone" placeholder="输入图形验证码" />
							</div>
							<div class="register-code-btn">
								<a class="register-phone-code-btn" href="javascript:;" id="moble_reg_send" onclick="moble_reg('sms')">获取验证码</a>
							</div>
						</div>
					</div>
				</div>

				<div class="register-item">
					<label>短信验证码</label>
					<input id="moble_verify" type="text" name="name" placeholder="请输入验证码" />
				</div>
				<div class="register-item">
					<label>登录密码</label>
					<input type="password" id="password" name="name" placeholder="请输入登陆密码" />
				</div>
				<div class="register-item">
					<label>确认密码</label>
					<input type="password" id="passwordConfirm" name="name" placeholder="再次输入密码" />
				</div>
				<div class="register-item">
					<label>邀请码（选填）</label>
					<input id="invit" type="text" name="name" placeholder="输入邀请码"/>
				</div>
				<div class="register-item tc register-agreement">
					<!--<span  id="regweb">我已阅读并同意《<a href="javascript:;" onclick="regWeb();">用户协议</a>》</span>-->
					<label><input type="checkbox" name="name" class="hide" id="regweb"><span id="regweb-tip">我已阅读并同意</span></label>《<a href="javascript:;" onclick="regWeb();">用户协议</a>》
				</div>
				<div class="register-item tc">
					<a class="register-form-submit disabled-submit-btn" onclick="reg_up();" href="#">注册</a>
				</div>
			</div>
			<div id="register-email-form" class="register-list">
				<div class="register-item">
					<label>邮箱</label>
					<input type="text" id="email" name="email" placeholder="输入邮箱" onblur="check_email()"/>
					<span id="reg_mail" class="" style="position: absolute; left: 190px;top: 2px;"></span>
				</div>
				<div class="register-item">
					<label>获取验证码</label>
					<div class="clearfix">
						<div class="register-phone-select">
							<img id="verifyUpEmail" src="{:U('Verify/code')}" title="换一张" onclick="this.src=this.src+'?t='+Math.random()" width="100" height="34"/>
						</div>
						<div class="clearfix register-phone-input">
							<div class="register-code-input">
								<input type="text" id="verifyEmail" name="phone" placeholder="输入图形验证码" />
							</div>
							<div class="register-code-btn">
								<a class="register-phone-code-btn" href="javascript:;" id="email_reg_send" onclick="email_reg_code('mail')">获取验证码</a>
							</div>
						</div>
					</div>
				</div>
				<div class="register-item">
					<label>邮箱验证码</label>
					<input id="email_verify" type="text" name="name" placeholder="请输入验证码" />
				</div>
				<div class="register-item">
					<label>登录密码</label>
					<input type="password" id="passwordEmail" name="name" placeholder="输入密码" />
				</div>
				<div class="register-item">
					<label>确认密码</label>
					<input type="password" id="passwordConfirmEmail" name="name" placeholder="再次输入密码" />
				</div>
				<div class="register-item">
					<label>邀请码（选填）</label>
					<input type="text" id="invitEmail" name="name" placeholder="输入邀请码"/>
				</div>
				<div class="register-item tc register-agreement">
					<label><input type="checkbox" name="name" class="hide" id="regEmail"><span id="regEmail-tip">我已阅读并同意</span></label>《<a href="javascript:;" onclick="regWeb();">用户协议</a>》
				</div>
				<div class="register-item tc">
					<a class="register-form-submit disabled-submit-btn" onclick="email_reg_up();" href="#">注册</a>
				</div>
			</div>
			<div class="register-form-info tc">国籍信息注册后不可修改，请务必如实选择。  验证邮箱可能会被误判为垃圾邮箱，请注意查收。 <br/> 请妥善保存您的bjs.bi账号已经登陆密码。  请勿和其他网站使用相同的登陆密码。</div>
		</div>
	</div>
</div>

<script>
	$(function () {
		var register = new bjsIndex();
		register.initRegister();
    });
    $("#registerBtn").addClass("active");

    function regWeb() {
        layer.open({
            type: 2,
            skin: 'layui-layer-rim', // 边框
            area: ['800px', '600px'], // 宽高
            title: '用户注册协议', // 标题
            content: "{:U('Login/webreg')}"
        });
    }

    function check_moble() {
        var moble  = $('#moble').val();
        var mobles = $('#mobles').val();
        if (moble == "" || moble == null) {
            layer.tips("请输入手机号", '#moble', {tips: 2});
            return false;
        }
        $.post("/login/check_moble.html", {
            moble: moble,
            mobles: mobles,
            token: ""
        }, function (data) {
            if (data.status == 1) {
                $("#verify").focus();
            } else {
                layer.tips(data.info, '#moble', {tips: 2});
                return false;
            }
        }, 'json');
    }
    function verify_ups() {
        $('#verify_up').attr('src', "/ajax/verify.html?t=" + Math.random());
    }
    function new_send() {
        $("#step1").show();
        $("#step2").show();
        $("#verify").focus();
    }
    function new_sends() {
        var moble  = $('#moble').val();
        var mobles = $('#mobles').val();
        if (moble == "" || moble == null) {
            layer.tips("请输入手机号", '#moble', {tips: 2});
            return false;
        }
        $.post("/login/check_moble.html", {
            moble: moble,
            mobles: mobles,
            token: ""
        }, function (data) {
            if (data.status == 1) {
                $("#verify").focus();
            } else {
                layer.tips(data.info, '#moble', {tips: 2});
                return false;
            }
        }, 'json');
    }
    function moble_reg(type) {
        if($('#moble_reg_send').html() != '获取验证码'){
            return;
        }
        var moble  = $("#moble").val();
        var mobles = $("#mobles").val();
        var verify = $("#verify").val();
        if (moble == "" || moble == null) {
            layer.tips("请输入手机号码", '#moble', {tips: 2});
            return false;
        }
        if (verify == "" || verify == null) {
            layer.tips("请输入图形验证码", '#verify', {tips: 2});
            return false;
        }
        $.post("/login/real.html", {
            moble: moble,
            mobles: mobles,
            type: type,
            verify: verify,
            token: ""
        }, function (data) {
            if (data.status == 1) {
                layer.msg(data.info, {icon: 1});

                $("#moble_verify").focus();
                $('#moble').attr("disabled", "disabled");
                $('#mobles').attr("disabled", "disabled");
                var obj      = $('#moble_reg_send');
                var wait     = 60;
                var interval = setInterval(function () {
                    obj.html(wait + "秒后可再发送");
                    wait--;
                    if (wait < 0) {
                        clearInterval(interval);
                        obj.html('获取验证码');
                    }
                    ;
                }, 1000);
            } else {
                layer.msg(data.info, {icon: 2,time:2000},function(){
                    if (data.url) {
                        window.location = data.url;
                    }
				});
            }
        }, "json");
    }

    function check_email(){
        var email  = $('#email').val();
        if (email == "" || email == null) {
            layer.tips("请输入邮箱", '#email', {tips: 2});
            return false;
        }
        $.post("/login/check_mail.html", {
            email: email,
            token: ""
        }, function (data) {
            if (data.status == 1) {
                $("#verifyEmail").focus();
            } else {
                layer.tips(data.info, '#email', {tips: 2});
                return false;
            }
        }, 'json');
	}

    function email_reg_code(type){
        if($('#email_reg_send').html() != '获取验证码'){
            return;
        }
        var email  = $("#email").val();
        var verifyEmail = $("#verifyEmail").val();
        if (email == "" || email == null) {
            layer.tips("请输入邮箱", '#email', {tips: 2});
            return false;
        }
        if (verifyEmail == "" || verifyEmail == null) {
            layer.tips("请输入图形验证码", '#verifyEmail', {tips: 2});
            return false;
        }
        $.post("/login/real_mail.html", {
            email: email,
            type: type,
            verifyEmail: verifyEmail,
            token: ""
        }, function (data) {
            if (data.status == 1) {
                layer.msg(data.info, {icon: 1});
                $("#verifyEmail").focus();
                $('#email').attr("disabled", "disabled");
                var obj      = $('#email_reg_send');
                var wait     = 60;
                var interval = setInterval(function () {
                    obj.html(wait + "秒后可发送");
                    wait--;
                    if (wait < 0) {
                        clearInterval(interval);
                        obj.html('获取验证码');
                    }
                    ;
                }, 1000);
            } else {
                layer.msg(data.info, {icon: 2,time:2000},function(){
                    if (data.url) {
                        window.location = data.url;
                    }
				});
            }
        }, "json");
	}
    function reg_up() {
        var moble        = $("#moble").val();
        var mobles       = $("#mobles").val();
        var moble_verify = $("#moble_verify").val();
        var password     = $("#password").val();
        var passwordConf = $("#passwordConfirm").val();
        var invit        = $("#invit").val();

        if (moble == "" || moble == null) {
            layer.tips("请输入手机号", '#moble', {tips: 2});
            return false;
        }
        if (moble_verify == "" || moble_verify == null) {
            layer.tips("请输入验证码", '#moble_verify', {tips: 2});
            return false;
        }
        if (password == "" || password == null) {
            layer.tips("请输入密码", '#password', {tips: 2});
            return false;
        }
        if(passwordConf != password){
            layer.tips("请确认两次密码相同", '#password', {tips: 2});
            $("#password").val('');
            $("#passwordConfirm").val('');
            return false;
		}
        if (!$("#regweb").is(':checked')) {
            layer.tips("请勾选用户注册协议", '#regweb-tip', {tips: 3});
            return false;
        }

        $.post("/login/upregister/", {
            username:moble,
            moble: moble,
            mobles: mobles,
            moble_verify: moble_verify,
            password: password,
            repassword: passwordConf,
            invit: invit,
            token: ""
        }, function (data) {
            if (data.status==1) {
                $.cookies.set('move_moble', moble);
                $.cookies.set('move_mobles', mobles);
                layer.msg(data.info, {icon: 1,time:2000},function(){
                    window.location = '/Login/paypassword';
				});
            } else {
                layer.msg(data.info, {icon: 2,time:2000},function(){
                    if (data.url) {
                        window.location = data.url;
                    }
				});
            }
        }, "json");
    }

    function email_reg_up(){
        var email        = $("#email").val();
        var email_verify = $("#email_verify").val();
        var password     = $("#passwordEmail").val();
        var passwordConf = $("#passwordConfirmEmail").val();
        var invit        = $("#invitEmail").val();

        if (email == "" || email == null) {
            layer.tips("请输入邮箱", '#email', {tips: 2});
            return false;
        }

        if (email_verify == "" || email_verify == null) {
            layer.tips("请输入邮箱验证码", '#email_verify', {tips: 2});
            return false;
        }
        if (password == "" || password == null) {
            layer.tips("请输入密码", '#passwordEmail', {tips: 2});
            return false;
        }
        if(passwordConf != password){
            layer.tips("请确认两次密码相同", '#passwordEmail', {tips: 2});
            $("#passwordEmail").val('');
            $("#passwordConfirmEmail").val('');
            return false;
        }
        if (!$("#regEmail").is(':checked')) {
            layer.tips("请勾选用户注册协议", '#regEmail-tip', {tips: 3});
            return false;
        }

        $.post("/login/upregisterEmail/", {
            email: email,
            emailVerify: email_verify,
            password: password,
            invit: invit,
            token: ""
        }, function (data) {
            if (data.status==1) {
                $.cookies.set('move_moble', email);
                layer.msg(data.info, {icon: 1,time:2000},function(){
                    window.location = '/Login/paypassword';
				});
            } else {
                layer.msg(data.info, {icon: 2,time:2000},function(){
                    if (data.url) {
                        window.location = data.url;
                    }
				});
            }
        }, "json");
	}
</script>

<include file="Public:footer" />
